<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tipsntech - Sistem Absensi Digital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            width: 100%;
            max-width: 1000px;
            height: 600px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            margin: 50px auto;
        }

        .login-left {
            flex: 1;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-right {
            flex: 1;
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 2.5rem;
            margin-right: 15px;
            color: #3498db;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .tagline {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .features {
            list-style: none;
            margin-bottom: 40px;
        }

        .features li {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .features i {
            margin-right: 10px;
            color: #27ae60;
        }

        .copyright {
            margin-top: auto;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .login-form-container {
            max-width: 350px;
            margin: 0 auto;
            width: 100%;
        }

        .login-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
        }

        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 10px;
        }

        .role-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .role-btn.active {
            background: var(--secondary);
            color: white;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .btn-primary {
            background: var(--success);
            color: white;
        }

        .btn-primary:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(39, 174, 96, 0.3);
        }

        /* Main App Styles */
        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .app-logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .app-logo h1 {
            font-size: 1.5rem;
            color: white;
        }

        .user-info {
            padding: 15px;
            background: rgba(255,255,255,0.1);
            margin: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .user-role {
            display: inline-block;
            padding: 4px 12px;
            background: var(--secondary);
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-link.active {
            background: var(--secondary);
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .nav-link.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .main-content {
            flex: 1;
            background: #f8f9fa;
            overflow-y: auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .content {
            padding: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .dashboard-hero {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .dashboard-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .dashboard-hero p {
            font-size: 1.2rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .filter-section {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
            position: sticky;
            top: 0;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-secondary {
            background: var(--gray);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary);
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .attendance-status {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-btn {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-btn.active {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .status-btn.sakit {
            border-color: var(--warning);
        }

        .status-btn.izin {
            border-color: var(--info);
        }

        .status-btn.alpa {
            border-color: var(--danger);
        }

        .auto-update-indicator {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 5px;
            padding: 10px 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .auto-update-indicator .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #27ae60;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .access-denied {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }

        .access-denied i {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .notification-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .notification-section h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
                height: auto;
                margin: 20px;
            }
            
            .login-left {
                padding: 30px;
            }
            
            .login-right {
                padding: 30px;
            }

            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .checkbox-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-left">
                <div class="logo">
                    <i class="fas fa-graduation-cap logo-icon"></i>
                    <div class="logo-text">dikaXNet</div>
                </div>
                <h1>Sistem Absensi Digital</h1>
                <p class="tagline">Platform digital untuk memudahkan proses absensi guru dan siswa</p>
                
                <ul class="features">
                    <li><i class="fas fa-check-circle"></i> Absensi real-time dengan teknologi terbaru</li>
                    <li><i class="fas fa-check-circle"></i> Rekapitulasi data dan terintegrasi</li>
                    <li><i class="fas fa-check-circle"></i> Notifikasi melalui WhatsApp</li>
                    <li><i class="fas fa-check-circle"></i> Laporan terperinci dan akurat</li>
                    <li><i class="fas fa-check-circle"></i> Antarmuka yang ramah pengguna</li>
                </ul>
                
                <div class="copyright">
                    Â© 2023 dikaXNet - Sistem Absensi Digital
                </div>
            </div>
            
            <div class="login-right">
                <div class="login-form-container">
                    <h2 class="login-title">Login</h2>
                    <p class="login-subtitle">Masuk ke sistem absensi digital</p>
                    
                    <div class="role-selector">
                        <button type="button" class="role-btn active" data-role="guru">Guru</button>
                        <button type="button" class="role-btn" data-role="siswa">Siswa</button>
                    </div>

                    <form id="loginForm">
                        <div class="form-group">
                            <label id="usernameLabel">Username</label>
                            <input type="text" class="form-control" id="username" placeholder="Masukkan username" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" class="form-control" id="password" placeholder="Masukkan password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="app-logo">
                <h1><i class="fas fa-graduation-cap"></i> dikaXNet</h1>
            </div>
            
            <div class="user-info">
                <div id="userName">Loading...</div>
                <div class="user-role" id="userRole">Loading...</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#beranda" class="nav-link active" data-page="beranda">
                        <i class="fas fa-home"></i> Beranda
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#data-siswa" class="nav-link" data-page="data-siswa" id="dataSiswaMenu">
                        <i class="fas fa-users"></i> Data Siswa
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#absensi" class="nav-link" data-page="absensi">
                        <i class="fas fa-clipboard-check"></i> Absensi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#laporan" class="nav-link" data-page="laporan" id="laporanMenu">
                        <i class="fas fa-chart-bar"></i> Laporan Rekapitulasi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#riwayat" class="nav-link" data-page="riwayat" id="riwayatMenu">
                        <i class="fas fa-history"></i> Riwayat Absensi
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="page-title">Beranda</h2>
                <div class="header-actions">
                    <span id="currentTime">Loading...</span>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Beranda Content -->
            <div class="content" id="beranda-content">
                <div class="dashboard-hero">
                    <h1>Sistem Absensi Digital</h1>
                    <p id="welcomeMessage">Selamat datang di sistem absensi digital</p>
                    <a href="#absensi" class="btn btn-primary" data-page="absensi">
                        <i class="fas fa-clipboard-check"></i> Mulai Absen Hari ini
                    </a>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSiswa">0</div>
                        <div class="stat-label">Total Siswa</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="hadirHariIni">0</div>
                        <div class="stat-label">Hadir Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tidakHadir">0</div>
                        <div class="stat-label">Tidak Hadir</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalKelas">0</div>
                        <div class="stat-label">Total Kelas</div>
                    </div>
                </div>

                <div class="notification-section">
                    <h4><i class="fas fa-bell"></i> Sistem Notifikasi</h4>
                    <p>Sistem akan mengirim notifikasi WhatsApp otomatis ke guru ketika siswa tidak hadir (Sakit, Izin, Alpa).</p>
                    <p><strong>Nomor Guru:</strong> 085321851127</p>
                </div>

                <div class="auto-update-indicator">
                    <div class="dot"></div>
                    <span>Sistem auto-update setiap hari pukul 23:59:59</span>
                </div>
            </div>

            <!-- Data Siswa Content -->
            <div class="content" id="data-siswa-content" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-users"></i> Manajemen Data Siswa</h2>
                    
                    <div class="notification-section">
                        <h4><i class="fas fa-info-circle"></i> Informasi Notifikasi</h4>
                        <p>Pastikan nomor WhatsApp orang tua diisi untuk fitur notifikasi. Notifikasi akan dikirim ke guru ketika siswa tidak hadir.</p>
                    </div>
                    
                    <div id="guruActions" class="action-buttons">
                        <button class="btn btn-primary" id="tambahSiswaBtn">
                            <i class="fas fa-plus"></i> Tambah Siswa
                        </button>
                        <button class="btn btn-secondary" id="importCSVBtn">
                            <i class="fas fa-file-import"></i> Import dari CSV
                        </button>
                        <button class="btn btn-whatsapp" id="testNotifikasiBtn">
                            <i class="fab fa-whatsapp"></i> Test Notifikasi
                        </button>
                        <button class="btn btn-danger" id="hapusDipilihBtn">
                            <i class="fas fa-trash"></i> Hapus yang Dipilih
                        </button>
                    </div>

                    <div id="siswaAccessMessage" class="access-denied" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>Akses Dibatasi</h3>
                        <p>Hanya guru yang dapat mengakses manajemen data siswa</p>
                    </div>

                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="form-group">
                                <label>Filter Kelas</label>
                                <select class="form-control" id="filterKelasSiswa">
                                    <option value="">Semua Kelas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Cari Siswa</label>
                                <input type="text" class="form-control" id="cariSiswa" placeholder="Nama atau username...">
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="table" id="tabelSiswa">
                            <thead>
                                <tr>
                                    <th width="50" id="selectAllTh"><input type="checkbox" id="selectAll"></th>
                                    <th width="60">NO</th>
                                    <th>NAMA LENGKAP</th>
                                    <th>USERNAME</th>
                                    <th>KELAS</th>
                                    <th>JENIS KELAMIN</th>
                                    <th>WHATSAPP ORTU</th>
                                    <th width="150" id="aksiTh">AKSI</th>
                                </tr>
                            </thead>
                            <tbody id="siswaTableBody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Absensi Content -->
            <div class="content" id="absensi-content" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-clipboard-check"></i> Pengisian Absensi Harian</h2>
                    
                    <div class="notification-section">
                        <h4><i class="fas fa-bell"></i> Notifikasi Otomatis</h4>
                        <p>Notifikasi WhatsApp akan otomatis dikirim ke guru ketika status siswa diubah menjadi Sakit, Izin, atau Alpa.</p>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="form-group">
                                <label>Pilih Tanggal</label>
                                <input type="date" class="form-control" id="tanggalAbsensi" value="">
                            </div>
                            <div class="form-group" id="filterKelasGroup">
                                <label>Filter Kelas</label>
                                <select class="form-control" id="filterKelasAbsensi">
                                    <option value="">Semua Kelas</option>
                                </select>
                            </div>
                            <div class="form-group" id="filterSiswaGroup" style="display: none;">
                                <label>Nama Siswa</label>
                                <input type="text" class="form-control" id="filterNamaSiswa" readonly>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="simpanAbsensiBtn">
                                <i class="fas fa-save"></i> Simpan Absensi
                            </button>
                            <button class="btn btn-whatsapp" id="notifikasiMassalBtn">
                                <i class="fab fa-whatsapp"></i> Kirim Notifikasi Massal
                            </button>
                        </div>
                    </div>

                    <div class="auto-update-indicator">
                        <div class="dot"></div>
                        <span>Absensi otomatis tersimpan. Update harian pukul 23:59:59</span>
                    </div>

                    <div class="table-container">
                        <table class="table" id="tabelAbsensi">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th>NAMA LENGKAP</th>
                                    <th>USERNAME</th>
                                    <th>KELAS</th>
                                    <th>STATUS KEHADIRAN</th>
                                    <th>CATATAN</th>
                                </tr>
                            </thead>
                            <tbody id="absensiTableBody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Laporan Content -->
            <div class="content" id="laporan-content" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-chart-bar"></i> Laporan Rekapitulasi Absensi</h2>
                    
                    <div id="laporanGuruAccess">
                        <div class="filter-section">
                            <h3>Filter Laporan</h3>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label>Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="tglMulaiLaporan">
                                </div>
                                <div class="form-group">
                                    <label>Tanggal Akhir</label>
                                    <input type="date" class="form-control" id="tglAkhirLaporan">
                                </div>
                                <div class="form-group">
                                    <label>Filter Kelas</label>
                                    <select class="form-control" id="filterKelasLaporan">
                                        <option value="">Semua Kelas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-whatsapp" id="shareWhatsAppBtn">
                                    <i class="fab fa-whatsapp"></i> Share via WhatsApp
                                </button>
                            </div>
                        </div>

                        <div class="auto-update-indicator">
                            <div class="dot"></div>
                            <span>Laporan terupdate otomatis. Data real-time dari sistem</span>
                        </div>

                        <h3 id="judulLaporan">Menampilkan Laporan untuk Kelas: Semua Kelas</h3>
                    </div>

                    <div id="laporanSiswaAccess" style="display: none;">
                        <div class="access-denied">
                            <i class="fas fa-chart-bar"></i>
                            <h3>Laporan Rekapitulasi</h3>
                            <p>Fitur ini hanya dapat diakses oleh guru</p>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table" id="tabelLaporan">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th>NAMA SISWA</th>
                                    <th>USERNAME</th>
                                    <th>KELAS</th>
                                    <th>HADIR</th>
                                    <th>SAKIT</th>
                                    <th>IZIN</th>
                                    <th>ALPA</th>
                                    <th>PERSENTASE</th>
                                </tr>
                            </thead>
                            <tbody id="laporanTableBody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Riwayat Content -->
            <div class="content" id="riwayat-content" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-history"></i> Riwayat Absensi</h2>
                    
                    <div id="riwayatGuruAccess">
                        <div class="filter-section">
                            <h3>Management Riwayat</h3>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label>Filter Kelas</label>
                                    <select class="form-control" id="filterKelasRiwayat">
                                        <option value="">Semua Kelas</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="tglMulaiRiwayat">
                                </div>
                                <div class="form-group">
                                    <label>Tanggal Akhir</label>
                                    <input type="date" class="form-control" id="tglAkhirRiwayat">
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-primary" id="filterRiwayatBtn">
                                    <i class="fas fa-filter"></i> Terapkan Filter
                                </button>
                                <button class="btn btn-whatsapp" id="shareRiwayatWhatsApp">
                                    <i class="fab fa-whatsapp"></i> Share via WhatsApp
                                </button>
                            </div>
                        </div>

                        <div class="auto-update-indicator">
                            <div class="dot"></div>
                            <span>Riwayat terupdate otomatis setiap perubahan data</span>
                        </div>
                    </div>

                    <div id="riwayatSiswaAccess" style="display: none;">
                        <div class="filter-section">
                            <h3>Riwayat Absensi Saya</h3>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label>Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="tglMulaiRiwayatSiswa">
                                </div>
                                <div class="form-group">
                                    <label>Tanggal Akhir</label>
                                    <input type="date" class="form-control" id="tglAkhirRiwayatSiswa">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="filterRiwayatSiswaBtn">
                                <i class="fas fa-filter"></i> Lihat Riwayat Saya
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="table" id="tabelRiwayat">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th>NAMA SISWA</th>
                                    <th>USERNAME</th>
                                    <th>KELAS</th>
                                    <th>TANGGAL</th>
                                    <th>STATUS</th>
                                    <th>CATATAN</th>
                                    <th>WAKTU</th>
                                </tr>
                            </thead>
                            <tbody id="riwayatTableBody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Siswa -->
    <div class="modal" id="modalTambahSiswa">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Tambah Siswa Baru</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="formTambahSiswa">
                <div class="form-group">
                    <label>Nama Lengkap *</label>
                    <input type="text" class="form-control" id="namaSiswa" required>
                </div>
                <div class="form-group">
                    <label>Username *</label>
                    <input type="text" class="form-control" id="usernameSiswa" required>
                </div>
                <div class="form-group">
                    <label>Kelas *</label>
                    <select class="form-control" id="kelasSiswa" required>
                        <option value="">Pilih Kelas</option>
                        <option value="10 TKJ">10 TKJ</option>
                        <option value="10 RPL">10 RPL</option>
                        <option value="10 MM">10 MM</option>
                        <option value="11 TKJ">11 TKJ</option>
                        <option value="11 RPL">11 RPL</option>
                        <option value="11 MM">11 MM</option>
                        <option value="12 TKJ">12 TKJ</option>
                        <option value="12 RPL">12 RPL</option>
                        <option value="12 MM">12 MM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Jenis Kelamin *</label>
                    <select class="form-control" id="jenisKelamin" required>
                        <option value="">Pilih Jenis Kelamin</option>
                        <option value="L">Laki-laki</option>
                        <option value="P">Perempuan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" class="form-control" id="passwordSiswa" placeholder="Password untuk login siswa" required>
                </div>
                <div class="form-group">
                    <label>Nomor WhatsApp Orang Tua *</label>
                    <input type="text" class="form-control" id="waOrtu" placeholder="Contoh: 6281234567890" required>
                    <small style="color: var(--gray); font-size: 0.8rem;">
                        *Wajib diisi untuk fitur notifikasi
                    </small>
                </div>
                <div class="form-group">
                    <label>Alamat</label>
                    <textarea class="form-control" id="alamatSiswa" rows="3"></textarea>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button type="button" class="btn btn-secondary" id="batalTambahSiswa">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let siswaData = JSON.parse(localStorage.getItem('siswaData')) || [];
        let absensiData = JSON.parse(localStorage.getItem('absensiData')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let kelasList = ['10 TKJ', '10 RPL', '10 MM', '11 TKJ', '11 RPL', '11 MM', '12 TKJ', '12 RPL', '12 MM'];
        let lastAutoUpdate = localStorage.getItem('lastAutoUpdate') || '';

        // Demo data
        const demoGuru = { username: 'guru', password: 'guru123', role: 'guru', nama: 'Guru Admin' };
        const demoSiswa = { username: 'siswa1', password: 'siswa123', role: 'siswa', nama: 'Andi Pratama', kelas: '12 TKJ' };

        // ========== FITUR NOTIFIKASI WHATSAPP ==========
        const NOMOR_GURU = '085321851127';

        // Fungsi untuk mengirim notifikasi WhatsApp
        function sendAbsenceNotification(siswaId, status, tanggal) {
            const siswa = siswaData.find(s => s.id === siswaId);
            if (!siswa) {
                console.log('Data siswa tidak ditemukan');
                return false;
            }

            if (!siswa.waOrtu) {
                console.log('Nomor WhatsApp orang tua tidak tersedia untuk:', siswa.nama);
                return false;
            }

            const formattedDate = formatTanggal(tanggal);
            
            // Pesan notifikasi
            const message = `*NOTIFIKASI ABSENSI SISWA*

Nama Siswa: ${siswa.nama}
Kelas: ${siswa.kelas}
Tanggal: ${formattedDate}
Status: ${status}

Sistem Absensi Digital dikaXNet
*Pesan ini dikirim otomatis*`;

            // Encode message untuk URL
            const encodedMessage = encodeURIComponent(message);
            
            // Buat URL WhatsApp
            const whatsappURL = `https://api.whatsapp.com/send?phone=${NOMOR_GURU}&text=${encodedMessage}`;
            
            // Buka WhatsApp di tab baru
            window.open(whatsappURL, '_blank');
            
            console.log('Notifikasi WhatsApp siap dikirim untuk:', siswa.nama);
            return true;
        }

        // Fungsi untuk mengirim notifikasi massal
        function sendBulkNotifications() {
            const today = new Date().toISOString().split('T')[0];
            const absentStudents = absensiData.filter(absensi => 
                absensi.tanggal === today && absensi.status !== 'HADIR'
            );

            if (absentStudents.length === 0) {
                alert('Tidak ada siswa yang absen hari ini.');
                return;
            }

            // Filter siswa yang memiliki nomor WhatsApp
            const studentsWithWA = absentStudents.filter(absensi => {
                const siswa = siswaData.find(s => s.id === absensi.siswaId);
                return siswa && siswa.waOrtu;
            });

            if (studentsWithWA.length === 0) {
                alert('Tidak ada siswa yang absen dengan nomor WhatsApp terdaftar.');
                return;
            }

            if (confirm(`Kirim notifikasi untuk ${studentsWithWA.length} siswa yang absen hari ini?`)) {
                studentsWithWA.forEach((absensi, index) => {
                    setTimeout(() => {
                        sendAbsenceNotification(absensi.siswaId, absensi.status, today);
                    }, index * 3000); // Delay 3 detik antara setiap notifikasi
                });
                
                alert(`Notifikasi akan dikirim untuk ${studentsWithWA.length} siswa. Pastikan browser tidak memblokir pop-up.`);
            }
        }

        // Fungsi test notifikasi
        function testNotification() {
            if (siswaData.length === 0) {
                alert('Tidak ada data siswa untuk testing.');
                return;
            }

            const siswa = siswaData[0]; // Ambil siswa pertama untuk testing
            const today = new Date().toISOString().split('T')[0];
            
            if (!siswa.waOrtu) {
                alert('Siswa pertama tidak memiliki nomor WhatsApp. Silakan tambahkan nomor WhatsApp di data siswa.');
                return;
            }

            if (confirm(`Test notifikasi untuk ${siswa.nama}?`)) {
                sendAbsenceNotification(siswa.id, 'TEST', today);
            }
        }

        // ========== END FITUR NOTIFIKASI ==========

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add demo data if not exists
            if (siswaData.length === 0) {
                siswaData.push({
                    id: 1,
                    nama: demoSiswa.nama,
                    username: demoSiswa.username,
                    kelas: demoSiswa.kelas,
                    jenisKelamin: 'L',
                    password: demoSiswa.password,
                    waOrtu: '6281234567890',
                    alamat: 'Jl. Contoh No. 123'
                });
                localStorage.setItem('siswaData', JSON.stringify(siswaData));
            }

            checkLoginStatus();
            setupLoginEvents();
        });

        function checkLoginStatus() {
            if (currentUser) {
                showApp();
            } else {
                showLogin();
            }
        }

        function setupLoginEvents() {
            // Role selector
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
        }

        function login() {
            const role = document.querySelector('.role-btn.active').dataset.role;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (role === 'guru') {
                // Login guru
                if (username === demoGuru.username && password === demoGuru.password) {
                    currentUser = demoGuru;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showApp();
                } else {
                    alert('Username atau password guru salah!');
                }
            } else {
                // Login siswa - menggunakan username dan password
                const siswa = siswaData.find(s => s.username === username);
                if (siswa && siswa.password === password) {
                    currentUser = {
                        id: siswa.id,
                        username: siswa.username,
                        nama: siswa.nama,
                        kelas: siswa.kelas,
                        role: 'siswa'
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showApp();
                } else {
                    alert('Username atau password siswa salah!');
                }
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginForm').reset();
            
            // Reset role selector
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-role="guru"]').classList.add('active');
        }

        function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            initializeApp();
            setupAutoUpdateSystem();
            loadSiswaData();
            updateStats();
            setupEventListeners();
            startRealTimeClock();
            updateUIBasedOnRole();
        }

        function updateUIBasedOnRole() {
            const isGuru = currentUser.role === 'guru';
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.nama;
            document.getElementById('userRole').textContent = isGuru ? 'GURU' : 'SISWA';
            document.getElementById('welcomeMessage').textContent = 
                `Selamat datang, ${currentUser.nama} (${isGuru ? 'Guru' : 'Siswa'})`;

            // Show/hide menu items based on role
            if (!isGuru) {
                document.getElementById('dataSiswaMenu').classList.add('disabled');
                document.getElementById('laporanMenu').classList.add('disabled');
                document.getElementById('riwayatMenu').classList.add('disabled');
            } else {
                document.getElementById('dataSiswaMenu').classList.remove('disabled');
                document.getElementById('laporanMenu').classList.remove('disabled');
                document.getElementById('riwayatMenu').classList.remove('disabled');
            }

            // Show/hide actions based on role
            document.getElementById('guruActions').style.display = isGuru ? 'flex' : 'none';
            document.getElementById('siswaAccessMessage').style.display = isGuru ? 'none' : 'block';
            
            // Show/hide table columns based on role
            const selectAllTh = document.getElementById('selectAllTh');
            const aksiTh = document.getElementById('aksiTh');
            if (selectAllTh && aksiTh) {
                selectAllTh.style.display = isGuru ? 'table-cell' : 'none';
                aksiTh.style.display = isGuru ? 'table-cell' : 'none';
            }

            // Show/hide filter for siswa
            document.getElementById('filterKelasGroup').style.display = isGuru ? 'block' : 'none';
            document.getElementById('filterSiswaGroup').style.display = isGuru ? 'none' : 'block';
            
            if (!isGuru) {
                document.getElementById('filterNamaSiswa').value = currentUser.nama;
            }

            // Show/hide laporan access
            document.getElementById('laporanGuruAccess').style.display = isGuru ? 'block' : 'none';
            document.getElementById('laporanSiswaAccess').style.display = isGuru ? 'none' : 'block';

            // Show/hide riwayat access
            document.getElementById('riwayatGuruAccess').style.display = isGuru ? 'block' : 'none';
            document.getElementById('riwayatSiswaAccess').style.display = isGuru ? 'none' : 'block';
        }

        function initializeApp() {
            // Set tanggal default untuk absensi
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalAbsensi').value = today;
            
            // Set tanggal default untuk laporan (1 bulan terakhir)
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            document.getElementById('tglMulaiLaporan').value = oneMonthAgo.toISOString().split('T')[0];
            document.getElementById('tglAkhirLaporan').value = today;
            document.getElementById('tglMulaiRiwayat').value = oneMonthAgo.toISOString().split('T')[0];
            document.getElementById('tglAkhirRiwayat').value = today;
            document.getElementById('tglMulaiRiwayatSiswa').value = oneMonthAgo.toISOString().split('T')[0];
            document.getElementById('tglAkhirRiwayatSiswa').value = today;
            
            // Populate kelas dropdowns
            populateKelasDropdowns();
            
            // Auto generate laporan pertama kali
            setTimeout(() => {
                generateLaporan();
                loadRiwayatData();
            }, 1000);
        }

        function setupAutoUpdateSystem() {
            checkDailyAutoUpdate();
            
            // Cek setiap 30 detik untuk auto update
            setInterval(() => {
                checkDailyAutoUpdate();
                updateStats();
            }, 30000);
        }

        function checkDailyAutoUpdate() {
            const now = new Date();
            const currentTime = now.toTimeString().split(' ')[0];
            const today = now.toISOString().split('T')[0];
            
            // Jika sudah lewat 23:59:59 dan belum diupdate hari ini
            if (currentTime >= '23:59:59' && lastAutoUpdate !== today) {
                performAutoUpdate();
            }
        }

        function performAutoUpdate() {
            const today = new Date().toISOString().split('T')[0];
            
            // Auto set ALPA untuk siswa yang belum diabsen hari ini
            siswaData.forEach(siswa => {
                const sudahAbsen = absensiData.some(absensi => 
                    absensi.siswaId === siswa.id && absensi.tanggal === today
                );
                
                if (!sudahAbsen) {
                    // Hapus duplikat dulu
                    absensiData = absensiData.filter(absensi => 
                        !(absensi.siswaId === siswa.id && absensi.tanggal === today)
                    );
                    
                    // Tambah status ALPA
                    absensiData.push({
                        id: Date.now(),
                        siswaId: siswa.id,
                        tanggal: today,
                        status: 'ALPA',
                        catatan: 'Auto-update sistem',
                        timestamp: new Date().toISOString()
                    });

                    // Kirim notifikasi untuk siswa yang ALPA
                    if (siswa.waOrtu) {
                        setTimeout(() => {
                            sendAbsenceNotification(siswa.id, 'ALPA', today);
                        }, 1000);
                    }
                }
            });
            
            localStorage.setItem('absensiData', JSON.stringify(absensiData));
            lastAutoUpdate = today;
            localStorage.setItem('lastAutoUpdate', today);
            
            console.log('Auto-update performed at:', new Date().toLocaleString());
        }

        function startRealTimeClock() {
            function updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('id-ID', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
                const dateString = now.toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                document.getElementById('currentTime').innerHTML = `
                    ${dateString}<br>
                    <strong>${timeString}</strong>
                `;
            }
            
            updateClock();
            setInterval(updateClock, 1000);
        }

        function setupEventListeners() {
            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    if (this.classList.contains('disabled')) {
                        e.preventDefault();
                        alert('Akses ditolak! Hanya guru yang dapat mengakses fitur ini.');
                        return;
                    }
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Modal handlers
            document.getElementById('tambahSiswaBtn').addEventListener('click', showTambahSiswaModal);
            document.getElementById('batalTambahSiswa').addEventListener('click', hideTambahSiswaModal);
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });

            // Form submission
            document.getElementById('formTambahSiswa').addEventListener('submit', tambahSiswa);

            // Filter handlers
            document.getElementById('filterKelasSiswa').addEventListener('change', filterSiswa);
            document.getElementById('cariSiswa').addEventListener('input', filterSiswa);
            document.getElementById('filterKelasAbsensi').addEventListener('change', loadAbsensiData);
            document.getElementById('tanggalAbsensi').addEventListener('change', loadAbsensiData);
            document.getElementById('simpanAbsensiBtn').addEventListener('click', simpanAbsensi);
            
            // WhatsApp handlers
            document.getElementById('shareWhatsAppBtn').addEventListener('click', shareLaporanWhatsApp);
            document.getElementById('shareRiwayatWhatsApp').addEventListener('click', shareRiwayatWhatsApp);
            document.getElementById('notifikasiMassalBtn').addEventListener('click', sendBulkNotifications);
            document.getElementById('testNotifikasiBtn').addEventListener('click', testNotification);

            // Checkbox handlers
            document.getElementById('selectAll').addEventListener('change', toggleSelectAll);

            // Auto-generate laporan ketika filter berubah
            document.getElementById('filterKelasLaporan').addEventListener('change', generateLaporan);
            document.getElementById('tglMulaiLaporan').addEventListener('change', generateLaporan);
            document.getElementById('tglAkhirLaporan').addEventListener('change', generateLaporan);

            // Auto-load riwayat ketika filter berubah
            document.getElementById('filterRiwayatBtn').addEventListener('click', loadRiwayatData);
            document.getElementById('filterRiwayatSiswaBtn').addEventListener('click', loadRiwayatSiswa);
        }

        function showPage(page) {
            // Hide all contents
            document.querySelectorAll('.content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected content and set active nav
            document.getElementById(`${page}-content`).style.display = 'block';
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            document.getElementById('page-title').textContent = 
                document.querySelector(`[data-page="${page}"]`).textContent.trim();
            
            // Load specific data for each page
            switch(page) {
                case 'data-siswa':
                    loadSiswaData();
                    break;
                case 'absensi':
                    loadAbsensiData();
                    break;
                case 'laporan':
                    generateLaporan();
                    break;
                case 'riwayat':
                    if (currentUser.role === 'siswa') {
                        loadRiwayatSiswa();
                    } else {
                        loadRiwayatData();
                    }
                    break;
            }
        }

        function populateKelasDropdowns() {
            const dropdowns = [
                'filterKelasSiswa',
                'filterKelasAbsensi', 
                'filterKelasLaporan',
                'filterKelasRiwayat'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.innerHTML = '<option value="">Semua Kelas</option>';
                    kelasList.forEach(kelas => {
                        dropdown.innerHTML += `<option value="${kelas}">${kelas}</option>`;
                    });
                }
            });
        }

        // SISWA MANAGEMENT
        function showTambahSiswaModal() {
            document.getElementById('modalTambahSiswa').style.display = 'flex';
            document.getElementById('formTambahSiswa').reset();
        }

        function hideTambahSiswaModal() {
            document.getElementById('modalTambahSiswa').style.display = 'none';
        }

        function tambahSiswa(e) {
            e.preventDefault();
            
            const newSiswa = {
                id: Date.now(),
                nama: document.getElementById('namaSiswa').value,
                username: document.getElementById('usernameSiswa').value,
                kelas: document.getElementById('kelasSiswa').value,
                jenisKelamin: document.getElementById('jenisKelamin').value,
                password: document.getElementById('passwordSiswa').value,
                waOrtu: document.getElementById('waOrtu').value,
                alamat: document.getElementById('alamatSiswa').value
            };
            
            // Cek apakah username sudah digunakan
            const existingSiswa = siswaData.find(s => s.username === newSiswa.username);
            if (existingSiswa) {
                alert('Username sudah digunakan! Silakan pilih username lain.');
                return;
            }
            
            siswaData.push(newSiswa);
            localStorage.setItem('siswaData', JSON.stringify(siswaData));
            
            hideTambahSiswaModal();
            loadSiswaData();
            updateStats();
            alert('Siswa berhasil ditambahkan!');
        }

        function loadSiswaData() {
            const tbody = document.getElementById('siswaTableBody');
            const filterKelas = document.getElementById('filterKelasSiswa').value;
            const searchTerm = document.getElementById('cariSiswa').value.toLowerCase();
            
            let filteredData = siswaData.filter(siswa => {
                const matchKelas = !filterKelas || siswa.kelas === filterKelas;
                const matchSearch = !searchTerm || 
                    siswa.nama.toLowerCase().includes(searchTerm) ||
                    siswa.username.toLowerCase().includes(searchTerm);
                return matchKelas && matchSearch;
            });
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <i class="fas fa-users"></i>
                                <p>Tidak ada data siswa.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredData.map((siswa, index) => `
                <tr>
                    <td><input type="checkbox" class="siswa-checkbox" value="${siswa.id}"></td>
                    <td>${index + 1}</td>
                    <td>${siswa.nama}</td>
                    <td>${siswa.username}</td>
                    <td>${siswa.kelas}</td>
                    <td>${siswa.jenisKelamin === 'L' ? 'Laki-laki' : 'Perempuan'}</td>
                    <td>${siswa.waOrtu || '<span style="color: #e74c3c;">Belum diisi</span>'}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editSiswa(${siswa.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="hapusSiswa(${siswa.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function filterSiswa() {
            loadSiswaData();
        }

        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.siswa-checkbox');
            const selectAll = document.getElementById('selectAll').checked;
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll;
            });
        }

        function editSiswa(id) {
            const siswa = siswaData.find(s => s.id === id);
            if (siswa) {
                document.getElementById('namaSiswa').value = siswa.nama;
                document.getElementById('usernameSiswa').value = siswa.username;
                document.getElementById('kelasSiswa').value = siswa.kelas;
                document.getElementById('jenisKelamin').value = siswa.jenisKelamin;
                document.getElementById('waOrtu').value = siswa.waOrtu || '';
                document.getElementById('passwordSiswa').value = siswa.password || '';
                document.getElementById('alamatSiswa').value = siswa.alamat || '';
                showTambahSiswaModal();
                // Untuk simplicity, edit akan menimpa data yang sama ID
            }
        }

        function hapusSiswa(id) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                siswaData = siswaData.filter(s => s.id !== id);
                localStorage.setItem('siswaData', JSON.stringify(siswaData));
                loadSiswaData();
                updateStats();
                alert('Siswa berhasil dihapus!');
            }
        }

        // ABSENSI MANAGEMENT
        function loadAbsensiData() {
            const tbody = document.getElementById('absensiTableBody');
            const filterKelas = document.getElementById('filterKelasAbsensi').value;
            const tanggal = document.getElementById('tanggalAbsensi').value;
            const isGuru = currentUser.role === 'guru';
            
            let filteredData = siswaData.filter(siswa => {
                if (!isGuru) {
                    // Untuk siswa, hanya tampilkan data dirinya sendiri
                    return siswa.id === currentUser.id;
                }
                // Untuk guru, filter berdasarkan kelas
                return !filterKelas || siswa.kelas === filterKelas;
            });
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-clipboard-list"></i>
                                <p>Tidak ada siswa.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredData.map((siswa, index) => {
                const absensiHariIni = absensiData.find(absensi => 
                    absensi.siswaId === siswa.id && absensi.tanggal === tanggal
                );
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${siswa.nama}</td>
                        <td>${siswa.username}</td>
                        <td>${siswa.kelas}</td>
                        <td>
                            <div class="attendance-status">
                                <button class="status-btn ${absensiHariIni?.status === 'HADIR' ? 'active' : ''}" 
                                        onclick="setStatusAbsensi(${siswa.id}, 'HADIR')">
                                    Hadir
                                </button>
                                <button class="status-btn sakit ${absensiHariIni?.status === 'SAKIT' ? 'active' : ''}" 
                                        onclick="setStatusAbsensi(${siswa.id}, 'SAKIT')">
                                    Sakit
                                </button>
                                <button class="status-btn izin ${absensiHariIni?.status === 'IZIN' ? 'active' : ''}" 
                                        onclick="setStatusAbsensi(${siswa.id}, 'IZIN')">
                                    Izin
                                </button>
                                <button class="status-btn alpa ${absensiHariIni?.status === 'ALPA' ? 'active' : ''}" 
                                        onclick="setStatusAbsensi(${siswa.id}, 'ALPA')">
                                    Alpa
                                </button>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control" 
                                   id="catatan-${siswa.id}" 
                                   value="${absensiHariIni?.catatan || ''}" 
                                   placeholder="Keterangan...">
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function setStatusAbsensi(siswaId, status) {
            const tanggal = document.getElementById('tanggalAbsensi').value;
            const catatan = document.getElementById(`catatan-${siswaId}`).value;
            
            // Hapus absensi sebelumnya untuk siswa dan tanggal yang sama
            absensiData = absensiData.filter(absensi => 
                !(absensi.siswaId === siswaId && absensi.tanggal === tanggal)
            );
            
            // Tambah absensi baru
            absensiData.push({
                id: Date.now(),
                siswaId: siswaId,
                tanggal: tanggal,
                status: status,
                catatan: catatan,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('absensiData', JSON.stringify(absensiData));
            
            // Kirim notifikasi jika status bukan HADIR
            if (status !== 'HADIR') {
                const siswa = siswaData.find(s => s.id === siswaId);
                if (siswa && siswa.waOrtu) {
                    setTimeout(() => {
                        sendAbsenceNotification(siswaId, status, tanggal);
                    }, 1000);
                } else {
                    console.log('Tidak bisa mengirim notifikasi: nomor WhatsApp tidak tersedia');
                }
            }
            
            loadAbsensiData();
            alert(`Status absensi diperbarui: ${status}${status !== 'HADIR' && siswaData.find(s => s.id === siswaId)?.waOrtu ? '\nNotifikasi akan dikirim ke guru.' : ''}`);
        }

        function simpanAbsensi() {
            alert('Absensi berhasil disimpan!');
            updateStats();
        }

        // LAPORAN MANAGEMENT
        function generateLaporan() {
            const tbody = document.getElementById('laporanTableBody');
            const filterKelas = document.getElementById('filterKelasLaporan').value;
            const tglMulai = document.getElementById('tglMulaiLaporan').value;
            const tglAkhir = document.getElementById('tglAkhirLaporan').value;
            
            document.getElementById('judulLaporan').textContent = 
                `Menampilkan Laporan untuk Kelas: ${filterKelas || 'Semua Kelas'}`;
            
            let filteredSiswa = siswaData.filter(siswa => {
                return !filterKelas || siswa.kelas === filterKelas;
            });
            
            if (filteredSiswa.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9">
                            <div class="empty-state">
                                <i class="fas fa-chart-bar"></i>
                                <p>Tidak ada data untuk ditampilkan.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredSiswa.map((siswa, index) => {
                const absensiSiswa = absensiData.filter(absensi => 
                    absensi.siswaId === siswa.id && 
                    absensi.tanggal >= tglMulai && 
                    absensi.tanggal <= tglAkhir
                );
                
                const hadir = absensiSiswa.filter(a => a.status === 'HADIR').length;
                const sakit = absensiSiswa.filter(a => a.status === 'SAKIT').length;
                const izin = absensiSiswa.filter(a => a.status === 'IZIN').length;
                const alpa = absensiSiswa.filter(a => a.status === 'ALPA').length;
                const total = hadir + sakit + izin + alpa;
                const persentase = total > 0 ? Math.round((hadir / total) * 100) : 0;
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${siswa.nama}</td>
                        <td>${siswa.username}</td>
                        <td>${siswa.kelas}</td>
                        <td><span class="badge badge-success">${hadir}</span></td>
                        <td><span class="badge badge-warning">${sakit}</span></td>
                        <td><span class="badge badge-info">${izin}</span></td>
                        <td><span class="badge badge-danger">${alpa}</span></td>
                        <td><strong>${persentase}%</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // RIWAYAT MANAGEMENT
        function loadRiwayatData() {
            const tbody = document.getElementById('riwayatTableBody');
            const filterKelas = document.getElementById('filterKelasRiwayat').value;
            const tglMulai = document.getElementById('tglMulaiRiwayat').value;
            const tglAkhir = document.getElementById('tglAkhirRiwayat').value;
            
            let filteredData = absensiData.filter(absensi => {
                const siswa = siswaData.find(s => s.id === absensi.siswaId);
                if (!siswa) return false;
                
                const matchKelas = !filterKelas || siswa.kelas === filterKelas;
                const matchTanggal = absensi.tanggal >= tglMulai && absensi.tanggal <= tglAkhir;
                
                return matchKelas && matchTanggal;
            });
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>Tidak ada riwayat absensi.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredData.map((absensi, index) => {
                const siswa = siswaData.find(s => s.id === absensi.siswaId);
                if (!siswa) return '';
                
                let statusBadge = '';
                switch(absensi.status) {
                    case 'HADIR': statusBadge = '<span class="badge badge-success">HADIR</span>'; break;
                    case 'SAKIT': statusBadge = '<span class="badge badge-warning">SAKIT</span>'; break;
                    case 'IZIN': statusBadge = '<span class="badge badge-info">IZIN</span>'; break;
                    case 'ALPA': statusBadge = '<span class="badge badge-danger">ALPA</span>'; break;
                }
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${siswa.nama}</td>
                        <td>${siswa.username}</td>
                        <td>${siswa.kelas}</td>
                        <td>${formatTanggal(absensi.tanggal)}</td>
                        <td>${statusBadge}</td>
                        <td>${absensi.catatan || '-'}</td>
                        <td>${formatTime(absensi.timestamp)}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadRiwayatSiswa() {
            const tbody = document.getElementById('riwayatTableBody');
            const tglMulai = document.getElementById('tglMulaiRiwayatSiswa').value;
            const tglAkhir = document.getElementById('tglAkhirRiwayatSiswa').value;
            
            let filteredData = absensiData.filter(absensi => {
                const siswa = siswaData.find(s => s.id === absensi.siswaId);
                if (!siswa) return false;
                
                const matchSiswa = siswa.id === currentUser.id;
                const matchTanggal = absensi.tanggal >= tglMulai && absensi.tanggal <= tglAkhir;
                
                return matchSiswa && matchTanggal;
            });
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>Tidak ada riwayat absensi.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredData.map((absensi, index) => {
                const siswa = siswaData.find(s => s.id === absensi.siswaId);
                if (!siswa) return '';
                
                let statusBadge = '';
                switch(absensi.status) {
                    case 'HADIR': statusBadge = '<span class="badge badge-success">HADIR</span>'; break;
                    case 'SAKIT': statusBadge = '<span class="badge badge-warning">SAKIT</span>'; break;
                    case 'IZIN': statusBadge = '<span class="badge badge-info">IZIN</span>'; break;
                    case 'ALPA': statusBadge = '<span class="badge badge-danger">ALPA</span>'; break;
                }
                
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${siswa.nama}</td>
                        <td>${siswa.username}</td>
                        <td>${siswa.kelas}</td>
                        <td>${formatTanggal(absensi.tanggal)}</td>
                        <td>${statusBadge}</td>
                        <td>${absensi.catatan || '-'}</td>
                        <td>${formatTime(absensi.timestamp)}</td>
                    </tr>
                `;
            }).join('');
        }

        function formatTanggal(tanggal) {
            const [tahun, bulan, hari] = tanggal.split('-');
            return `${hari}/${bulan}/${tahun}`;
        }

        function formatTime(timestamp) {
            if (!timestamp) return '-';
            return new Date(timestamp).toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const hadirHariIni = absensiData.filter(a => a.tanggal === today && a.status === 'HADIR').length;
            
            document.getElementById('totalSiswa').textContent = siswaData.length;
            document.getElementById('totalKelas').textContent = new Set(siswaData.map(s => s.kelas)).size;
            document.getElementById('hadirHariIni').textContent = hadirHariIni;
            document.getElementById('tidakHadir').textContent = siswaData.length - hadirHariIni;
        }

        function shareLaporanWhatsApp() {
            alert('Fitur share WhatsApp akan membuka aplikasi WhatsApp...');
            // Implementasi share WhatsApp bisa ditambahkan di sini
        }

        function shareRiwayatWhatsApp() {
            alert('Fitur share WhatsApp akan membuka aplikasi WhatsApp...');
            // Implementasi share WhatsApp bisa ditambahkan di sini
        }
    </script>
</body>
</html>